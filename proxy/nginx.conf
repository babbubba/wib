server {
  listen 80;
  server_name _;
  client_max_body_size 20m;

  # Backend API routes
  location /receipts {
    proxy_pass http://api:8080/receipts;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header Authorization $http_authorization;
  }

  location /analytics {
    proxy_pass http://api:8080/analytics;
    proxy_set_header Host $host;
    proxy_set_header Authorization $http_authorization;
  }

  location /auth {
    proxy_pass http://api:8080/auth;
    proxy_set_header Host $host;
  }

  location /queue {
    proxy_pass http://api:8080/queue;
    proxy_set_header Host $host;
    proxy_set_header Authorization $http_authorization;
  }

  location /storage {
    proxy_pass http://api:8080/storage;
    proxy_set_header Host $host;
    proxy_set_header Authorization $http_authorization;
  }
  location /storage/object {
    proxy_pass http://api:8080/storage/object;
    proxy_set_header Host $host;
    proxy_set_header Authorization $http_authorization;
  }

  # ML API endpoints exposed via WIB.API
  location /ml/suggestions {
    proxy_pass http://api:8080/ml/suggestions;
    proxy_set_header Host $host;
    proxy_set_header Authorization $http_authorization;
  }

  location /ml/feedback {
    proxy_pass http://api:8080/ml/feedback;
    proxy_set_header Host $host;
    proxy_set_header Authorization $http_authorization;
  }

  # ML and OCR passthrough (debug/health)
  location /ml/ {
    proxy_pass http://ml:8082/;
  }

  location /ocr/ {
    proxy_pass http://ocr:8081/;
  }

  # KIE endpoint
  location /kie {
    proxy_pass http://ocr:8081/kie;
  }

  # Default
  location / {
    add_header Content-Type text/plain;
    return 200 'wib-proxy';
  }
}
