<!-- Show login if not authenticated -->
<app-login *ngIf="!isAuthenticated()"></app-login>

<!-- Show upload interface if authenticated -->
<div *ngIf="isAuthenticated()">
<header class="brand-header">
  <div class="brand-shell">
    <img class="brand-logo" src="assets/logo-bsoft.png" alt="bSoft" />
    <div class="brand-titles">
      <h1 class="brand-title">Upload Scontrino</h1>
      <p class="brand-sub">WIB Devices</p>
    </div>
  </div>
</header>

<main class="page-shell">
  <section class="card">
    <div class="actions">
      <label class="btn primary">
        Scatta o scegli foto
        <input #fileInput type="file" accept="image/*" capture="environment" (change)="onFile($event)" hidden />
      </label>
      <div class="switch">
        <input class="switch-input" type="checkbox" id="swMulti" [checked]="multiMode()" (change)="multiMode.set($any($event.target).checked)" />
        <label for="swMulti">Modalit√† sequenziale</label>
      </div>
    </div>

    <div *ngIf="fileName()" class="selected">Selezionato: <strong>{{ fileName() }}</strong></div>

    <div class="preview-wrap" *ngIf="preview()">
      <img [src]="preview()" alt="Anteprima scontrino" class="preview-img" />
    </div>

    <div class="submit-row">
      <button class="btn success" [disabled]="!file() || uploading()" (click)="upload()">
        {{ uploading() ? (progress()>0 ? ('Caricamento ' + progress() + '%') : 'Preparazione...') : 'Carica' }}
      </button>
    </div>

    <div *ngIf="result()" class="alert ok">
      Caricamento completato. ID immagine: <code>{{ successId() }}</code>
      <div class="row">
        <button class="btn small success" (click)="multiMode.set(true); afterSuccessNext()">Prossimo scontrino</button>
        <button class="btn small" (click)="backToCamera()">Torna a "Scatta foto"</button>
      </div>
    </div>

    <div *ngIf="error()" class="alert err">Errore: {{ error() }}</div>
  </section>
</main>
</div>
