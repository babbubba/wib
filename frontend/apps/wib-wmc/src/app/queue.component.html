<main class="container py-3">
  <h2 class="mb-3">Coda Elaborazione</h2>
  <!-- Auth handled via dedicated /login route and global interceptor/guard -->
  <div class="d-flex align-items-center gap-3 mb-2">
    <button class="btn btn-outline-primary btn-sm" (click)="refresh()">Aggiorna</button>
    <label class="form-label m-0">Mostra primi</label>
    <input class="form-control" type="number" min="1" max="100" [value]="take()" (change)="onTakeChange($event)" style="width:80px" />
    <div>In coda: <span class="badge bg-secondary">{{ length() }}</span></div>
  </div>
  <ul class="list-group mb-3">
    <li class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let k of pending()">
      <code class="text-truncate" style="max-width:70%">{{ k }}</code>
      <button class="btn btn-sm btn-outline-success" (click)="reprocessKey(k)">Riprocessa</button>
    </li>
  </ul>
  <form class="row gy-2 gx-2 align-items-center mb-3" (submit)="reprocessObject($event)">
    <div class="col"><input class="form-control" placeholder="objectKey MinIO" [value]="objectKey()" (input)="objectKey.set($any($event.target).value)" /></div>
    <div class="col-auto"><button class="btn btn-primary" type="submit">Riprocessa objectKey</button></div>
  </form>

  <div class="card mb-3">
    <div class="card-header d-flex justify-content-between align-items-center">
      <span>Oggetti MinIO ({{ unprocessedOnly() ? 'non processati' : 'tutti' }})</span>
      <div class="d-flex gap-2 align-items-center">
        <input class="form-control form-control-sm" style="width:220px" placeholder="prefix" [value]="prefix()" (input)="prefix.set($any($event.target).value)" />
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" [checked]="unprocessedOnly()" (change)="onToggleUnprocessed($event)" id="swUnp" />
          <label class="form-check-label" for="swUnp">solo non processati</label>
        </div>
        <button class="btn btn-sm btn-outline-primary" (click)="refresh()">Aggiorna</button>
      </div>
    </div>
    <div class="card-body">
      <div class="form-check mb-2">
        <input class="form-check-input" type="checkbox" id="chkAll" (change)="toggleAll($event)" />
        <label class="form-check-label" for="chkAll">Seleziona tutto</label>
        <button class="btn btn-sm btn-success ms-2" (click)="bulkEnqueue()">Accoda selezionati</button>
      </div>
      <div class="row g-3">
        <div class="col-12 col-md-6 col-lg-4" *ngFor="let k of storeKeys()">
          <div class="card h-100">
            <img class="card-img-top" [attr.src]="previewSrc(k)" alt="preview" />
            <div class="card-body">
              <div class="form-check">
                <label class="form-check-label text-truncate" [attr.title]="k">
                  <input class="form-check-input me-2" type="checkbox" [checked]="isSelected(k)" (change)="onToggleSelection(k, $event)">
                  <code>{{ k }}</code>
                </label>
              </div>
              <button class="btn btn-sm btn-outline-success mt-2" (click)="reprocessKey(k)">Accoda</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">Log operazioni</div>
    <div class="card-body">
      <pre class="mb-0" [textContent]="logText()" style="white-space: pre-wrap; max-height: 200px; overflow: auto;"></pre>
    </div>
  </div>
</main>





