<main class="container py-4" style="max-width: 640px;">
  <h1 class="mb-3">WIB Devices - Upload Scontrino</h1>
  <label class="btn btn-outline-secondary mb-2">
    Scatta o scegli foto
    <input #fileInput type="file" accept="image/*" capture="environment" (change)="onFile($event)" hidden />
  </label>

  <div *ngIf="fileName()" class="mb-2">Selezionato: <strong>{{ fileName() }}</strong></div>
  <img *ngIf="preview()" [src]="preview()" alt="preview" class="img-fluid rounded border mb-2" />

  <div class="form-check form-switch mb-2">
    <input class="form-check-input" type="checkbox" id="swMulti" [checked]="multiMode()" (change)="multiMode.set($any($event.target).checked)" />
    <label class="form-check-label" for="swMulti">Modalit√† sequenziale (carica subito e passa al prossimo)</label>
  </div>

  <button class="btn btn-primary" [disabled]="!file() || uploading()" (click)="upload()">
    {{ uploading() ? (progress()>0 ? ('Caricamento ' + progress() + '%') : 'Preparazione...') : 'Carica' }}
  </button>

  <div *ngIf="result()" class="alert alert-success mt-2">
    Caricamento completato. ID immagine: <code>{{ successId() }}</code>
    <div class="mt-2 d-flex gap-2">
      <button class="btn btn-sm btn-success" (click)="multiMode.set(true); afterSuccessNext()">Prossimo scontrino</button>
      <button class="btn btn-sm btn-outline-secondary" (click)="backToCamera()">Torna a "Scatta foto"</button>
    </div>
  </div>
  <div *ngIf="error()" class="alert alert-danger mt-2">Errore: {{ error() }}</div>
</main>
